## 问题复盘
- 个人资料页存在大量 `getActivity()` 直接使用，Fragment 未附着或视图已销毁时易触发 NPE：
  - 例如 `new DatabaseHelper(getActivity())`、`AlertDialog.Builder(getActivity)`、`getActivity().getSharedPreferences(...)`、`FileProvider.getUriForFile(getActivity, ...)` 等，均在 `ProfileFragment.java:88, 124, 176, 208, 223, 273, 291, 299–301, 311, 322–359, 370–380, 409–418, 423–435, 445–460`。
  - `onActivityResult` 使用 `getActivity().RESULT_OK`（静态常量应为 `Activity.RESULT_OK`），见 `ProfileFragment.java:386`。
  - 未判空直接使用 `currentTeacher`（如用户名修改、头像保存），见 `ProfileFragment.java:327, 346, 418, 450`。
  - UI 更新（`Glide.into(profileImageView)`、`TextView.setText(...)`）未做生命周期与视图非空保护，见 `ProfileFragment.java:161–170, 445–447`。
- 进入应用仍为空白且未直达首页：当前 Launcher 为 `LoginActivity`（`AndroidManifest.xml:26–34`），自动登录依赖 `remember_password=true` 且 `teacher_id != -1`（`LoginActivity.java:172–181`），不满足时停留登录页；若用户期望“已登录就直达首页”，需放宽条件。

## 改动方案（分步最小改动）
### 第1步：ProfileFragment 关键空指针修复
- 将 `new DatabaseHelper(getActivity())` 改为 `new DatabaseHelper(requireContext())`（`ProfileFragment.java:88`）。
- 关键路径统一使用安全上下文：
  - `SharedPreferences/AlertDialog/FileProvider/ContentResolver/外部文件目录` 改用 `requireContext()/requireActivity()`；在非强制场景前置 `isAdded()` 与 `getActivity()!=null` 校验（涉及 `ProfileFragment.java:124, 176, 208, 223, 273, 291, 299–301, 311, 322–359, 370–380, 409–418, 423–435, 445–460`）。
- 修正 `onActivityResult` 判定：使用 `resultCode == Activity.RESULT_OK`（`ProfileFragment.java:386`）。
- 对业务对象增加判空与按钮可用性管理：
  - 在 `showChangeUsernameDialog()` 与头像相关流程前判 `currentTeacher != null`，否则提示并返回（`ProfileFragment.java:327, 346, 418, 450`）。
- UI 更新加生命周期保护：
  - 在 `loadUserData()` 与 `updateProfileImage()` 中，更新视图前判 `isAdded()` 且视图非空（`ProfileFragment.java:161–170, 445–447`）。
- 新增 `onDestroyView()`：将 `profileImageView/usernameTextView/emailTextView/所有 Button/itemMoreSettings/itemAbout/progressBar` 置 `null`，避免视图销毁后访问。
- `copyUriToFile()` 使用 `try-with-resources` 并判 `inputStream != null`（`ProfileFragment.java:423–434`）。

### 第2步：进入应用空白与未直达首页处理
- 修改自动登录条件：只要 `teacher_id != -1` 即跳转 `MainActivity`，不再依赖 `remember_password`（`LoginActivity.java:172–181`）。
- 在 `MainActivity.onCreate` 调用 `handleNavigation(savedNav)` 后增加容错：若未成功加载 Fragment，则强制加载首页（`MainActivity.java:134–139, 183–216`）。
- 如仍出现“空白”现象，临时增加日志定位（不改变功能），排查设备主题与资源遮挡等边界情况。

## 验证与交付
- 编译通过并运行，验证：
  - 启动应用：若已登录（存在有效 `teacher_id`），直接进入首页；未登录则显示登录页。
  - 进入“我的”页：修改用户名、拍照/相册换头像、关于与更多设置弹窗，均无闪退且功能正常。
- 回归登录：勾选/取消“记住密码”两种场景下均能按预期进入首页。

## 影响范围与风险
- 仅修改 `ProfileFragment`、`LoginActivity`（轻触 `MainActivity` 容错），不改数据库结构与资源；改动遵循最小化与可逆原则。

## 执行顺序与确认
- 先执行第1步修复个人资料页空指针（保证不再闪退），编译运行验证；再执行第2步优化自动登录与首页直达。
- 请确认按该顺序推进。