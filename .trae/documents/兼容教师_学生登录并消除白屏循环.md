## 核心诊断
- 循环链路：MainActivity → 切换到“我的”(ProfileFragment) → 执行登录检查 → 回到 LoginActivity → 再跳回 MainActivity → 再进入“我的”…
- 关键证据：MainActivity 日志“切换到我的”(MainActivity.java:205 附近)，随即出现 LoginActivity.onCreate(LoginActivity.java:75)，说明“我的”页触发了回登录。
- 直接原因：ProfileFragment 仅按 `teacher_id` 判断登录有效，学生登录时 `teacher_id==-1` 被判“教师信息无效”并 `navigateToLogin()`。

## 修复目标
- 统一登录态：教师或学生任一有效即可视为“已登录”。
- 资料页兼容角色：学生进入“我的”不再被踢回登录，改为展示学生信息并禁用教师专属操作。
- 消除循环：移除在 Fragment 生命周期中“强制跳登录”的行为，全链路只在明确退出时跳登录。

## 具体修改
### 1) LoginActivity（保持一次性跳转）
- 保留一次性跳转标志 `navigated`，继续只在 `onCreate` 做自动跳转（已改好）。
- 登录成功时写入 `user_role` 和对应 `id`；若 `role=student`，重置 `ui_prefs.nav_selected_id=R.id.nav_home`，避免进入不适配页面。
- 参考位置：LoginActivity.java:75–85（读取 `user_role`/`teacher_id`/`student_id` 并跳转）。

### 2) MainActivity（角色感知的导航）
- 启动时读取 `user_role`/`teacher_id`/`student_id`，任一有效则通过，均无效才跳登录。（MainActivity.java:86–98 已基本修正）
- 读取 `ui_prefs.nav_selected_id` 后：若 `role=student` 且目标为教师专属（课堂/考勤/我的），强制改为首页。
- 在 `handleNavigation(itemId)` 拦截：`role=student` 选择教师专属项时，改为首页并提示，避免再次进入“我的”。

### 3) ProfileFragment（兼容学生信息）
- 读取 `user_role`：
  - 若 `teacher`：按原逻辑展示教师信息；但移除在无效时“强制跳登录”，改为提示并保留页面。
  - 若 `student`：通过 `DatabaseHelper.getStudentById(student_id)` 读取学生姓名/学号/头像并展示；隐藏或禁用教师专属操作（修改用户名/头像、更多设置等）。
- 移除任何在 `onCreateView/onViewCreated` 中直接 `navigateToLogin()` 的路径，仅保留“退出”按钮触发登录。
- 参考位置：ProfileFragment.java 读取偏好与 `navigateToLogin()` 附近（约 120–140 行和点击事件处理）。

### 4) 统一登录判断帮助（最小改动）
- 不新增大类库，仅在 Fragment/Activity 本地以 `user_role` + 对应 `id` 判断“是否登录”。
- 后续可将登录判断抽为 `AuthSession` 辅助类，但本次保持最小变更。

## 验证用例
- 学生登录：进入首页，点“我的”不跳登录，显示学生信息；切换到课堂/考勤时被拦截回首页并提示。
- 教师登录：行为不变；“我的”正常显示；退出登录后回登录页。
- 角色切换：清理并重置导航项，不进入不适配页面。

## 交付顺序
1) 在 LoginActivity 成功登录后重置学生的默认导航到首页。
2) 在 MainActivity 启动与 `handleNavigation` 中加入学生对教师页的拦截与修正。
3) 改造 ProfileFragment 兼容学生信息显示，移除生命周期中的跳登录。
4) 运行验证并查看 Logcat，确保无 Main↔Login 循环，白屏消失。

## 代码参考定位
- LoginActivity 自动跳转：app/src/main/java/com/example/facecheck/ui/auth/LoginActivity.java:75–85
- MainActivity 导航切换日志：app/src/main/java/com/example/facecheck/MainActivity.java:202–220（handleNavigation）
- ProfileFragment 登录检查与跳转：app/src/main/java/com/example/facecheck/fragments/ProfileFragment.java（读取偏好与 `navigateToLogin()` 的判断段，约 120–150 行）

如确认按此方案执行，我将开始改造 ProfileFragment 兼容学生信息，并加强 MainActivity 导航拦截，确保彻底消除循环。