# FaceCheck 项目考勤功能设计说明（教师照片考勤 + 学生自拍考勤）

> 说明：本设计**不修改数据库结构和建表 SQL**，只是在现有字段和实体之上做业务扩展与流程设计，后续实现时只改业务代码。

---

## 1. 概念与目标

### 1.1 目标概述

围绕当前 FaceCheck 项目的考勤功能，目标是：

1. **学生端**
   - 现有底部导航中的「选课」页面（`StudentCoursesFragment`）不再作为选课使用；
   - 改造成一个**“班级签到对话页”**：
     - 显示当前学生所属的班级；
     - 每个班级下显示该班级的考勤会话（签到），列表样式类似聊天对话；
     - 目前只做“签到内容”（老师发起签到、学生自己签到），不做自由聊天。

2. **教师端**
   - 教师发起考勤时，不再是只有“导入合照自动识别”一种方式；
   - 教师在发起考勤时可以选择：
     1. **教师照片考勤**：沿用现在的模式——老师导入/拍摄一张班级合照，多人人脸识别；
     2. **学生自拍考勤**：老师只是“发布签到任务”，班级成员各自用客户端自拍单人脸完成签到。

3. **识别方式**
   - 教师照片考勤：沿用当前的多人识别流程；
   - 学生自拍考勤：只使用“单人脸导入 + 识别”的流程，不做同一张图上的多人识别。

4. **实体概念**
   - “签到/考勤”是一个实体，不是一次临时操作：
     - 一次教师发起的签到 = 一条 `AttendanceSession`；
     - 每个学生在这次签到中的状态 = 对应的一条 `AttendanceResult`。

---

## 2. 现有核心实体与代码位置

本节只描述现状，不涉及任何修改。

### 2.1 考勤相关表结构（仅说明，不改 SQL）

**文件：**  
[DatabaseHelper.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/database/DatabaseHelper.java)

#### 2.1.1 AttendanceSession（考勤会话）

```sql
CREATE TABLE IF NOT EXISTS AttendanceSession (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    classId INTEGER NOT NULL,
    teacherId INTEGER NOT NULL,
    startedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    endedAt TIMESTAMP,
    location TEXT,
    photoUri TEXT,
    note TEXT,
    status TEXT DEFAULT 'ACTIVE' CHECK(status IN ('ACTIVE', 'COMPLETED', 'CANCELLED')),
    attendanceType TEXT DEFAULT 'FACE' CHECK(attendanceType IN ('FACE', 'MANUAL', 'MIXED')),
    FOREIGN KEY (classId) REFERENCES Classroom(id) ON DELETE CASCADE,
    FOREIGN KEY (teacherId) REFERENCES Teacher(id) ON DELETE CASCADE
);
```

> 说明：
> - 一条 `AttendanceSession` = 一次“老师发起的考勤/签到”；
> - 已存在字段 `attendanceType`，后续设计中**只调整其使用方式，不修改表结构**。

#### 2.1.2 AttendanceResult（考勤结果）

```sql
CREATE TABLE IF NOT EXISTS AttendanceResult (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sessionId INTEGER NOT NULL,
    studentId INTEGER NOT NULL,
    status TEXT NOT NULL CHECK(status IN ('Present', 'Absent', 'Late', 'Leave', 'Unknown')),
    score REAL CHECK(score >= 0 AND score <= 1),
    confidence REAL,
    checkInTime TIMESTAMP,
    checkOutTime TIMESTAMP,
    decidedBy TEXT NOT NULL CHECK(decidedBy IN ('AUTO', 'TEACHER', 'SYSTEM')),
    decidedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    note TEXT,
    FOREIGN KEY (sessionId) REFERENCES AttendanceSession(id) ON DELETE CASCADE,
    FOREIGN KEY (studentId) REFERENCES Student(id) ON DELETE CASCADE
);
```

> 说明：
> - 一条 `AttendanceResult` = 某一次考勤会话下，某个学生的一次状态记录；
> - 当前自动识别逻辑已经在使用这个表，并且通过 `sessionId` 进行聚合。

#### 2.1.3 相关数据库操作方法

同文件中：

- 创建考勤会话：
  ```java
  public long insertAttendanceSession(long classId, long teacherId,
                                      String location, String photoUri, String note)
  ```
- 写入考勤结果：
  ```java
  public long insertAttendanceResult(long sessionId, long studentId,
                                     String status, float score, String decidedBy)
  ```
- 按会话读取结果（用于结果页）：
  ```java
  public Cursor getAttendanceResultsBySession(long sessionId)
  ```
- 按教师/学生 + 日期范围查询（用于统计/历史）：
  ```java
  public Cursor getAttendanceResultsByTeacherAndDateRange(...)
  public Cursor getAttendanceResultsByStudentAndDateRange(...)
  ```

> 后续所有设计均**基于上述现有结构和方法，不增加字段，不改 SQL**。

---

## 3. 现有业务流程梳理

### 3.1 教师端：从班级到考勤的流程

**班级列表（教师视角）**

- 文件：[ClassroomFragment.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/fragments/ClassroomFragment.java)  
  展示当前教师的所有班级，点击班级进入班级详情：

  ```java
  adapter.setOnItemClickListener(classroom -> {
      Intent intent = new Intent(getActivity(), ClassroomActivity.class);
      intent.putExtra("classroom_id", classroom.getId());
      intent.putExtra("action", "edit");
      startActivity(intent);
  });
  ```

**选择班级进行考勤**

- 文件：[ClassroomSelectionActivity.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/ui/classroom/ClassroomSelectionActivity.java)

  在 `mode = "attendance"` 模式下，教师从这里选择要考勤的班级：

  ```java
  private void onClassroomSelected(Classroom classroom) {
      if ("attendance".equals(mode)) {
          Intent intent = new Intent(this, AttendanceActivity.class);
          intent.putExtra("classroom_id", classroom.getId());
          intent.putExtra("classroom_name", classroom.getName());
          startActivity(intent);
          finish();
      } else {
          // 其他模式...
      }
  }
  ```

**发起考勤会话 + 导入合照 + 多人识别**

- 文件：[AttendanceActivity.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/ui/attendance/AttendanceActivity.java)

  核心点：

  1. `onCreate` 中，根据 `classroom_id` 初始化，并**立刻创建一条 AttendanceSession**：
     ```java
     classroomId = getIntent().getLongExtra("classroom_id", -1);
     ...
     dbHelper = new DatabaseHelper(this);
     ...
     createAttendanceSession();
     ```

  2. `createAttendanceSession()`：
     ```java
     private void createAttendanceSession() {
         sessionId = dbHelper.insertAttendanceSession(classroomId, 1L, "", "", "");
         ...
     }
     ```

     > 当前 teacherId 暂写死为 `1L`，这一点与后续设计无关，此处只记录现状。

  3. 教师导入/拍摄照片，走 ML Kit 检测 + 特征提取 + 多人比对，最终调用：

     ```java
     private void persistAttendanceResultsForSession(long sessionId,
             List<FaceRecognitionManager.RecognitionResult> results) {
         // 根据 results 写入 AttendanceResult 表
     }
     ```

  4. 识别结果展示在  
     [AttendanceResultActivity.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/ui/attendance/AttendanceResultActivity.java)。

### 3.2 学生端：当前主要页面

#### 3.2.1 学生端“选课页”（待改造目标）

- 文件：[MainActivity.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/MainActivity.java)

  底部导航的 `nav_courses` 当前绑定：

  ```java
  } else if (itemId == R.id.nav_courses) {
      selectedFragment = new com.example.facecheck.fragments.StudentCoursesFragment();
      if (getSupportActionBar() != null) getSupportActionBar().setTitle("选课");
  }
  ```

- 文件：[StudentCoursesFragment.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/fragments/StudentCoursesFragment.java)

  内容特点：

  - 使用 `generateMockCourses()` 生成假课程列表；
  - 用 `StudentCourseAdapter` 渲染成一个简单的课程选择列表；
  - 确认选课后，写入 `student_prefs` 并切换到底部 `nav_attendance`。

> 这个页面与真实考勤实体、学生真实班级没有直接绑定。  
> 按需求，它将被改造成 **“班级签到对话页”**，显示 AttendanceSession/Result。

#### 3.2.2 学生/教师通用的考勤历史（按日汇总）

- 文件：[AttendanceFragment.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/fragments/AttendanceFragment.java)

  特点：

  - 根据 `user_role`（`teacher` / `student`）决定查询：
    - 学生：`getAttendanceResultsByStudentAndDateRange(...)`
    - 教师：`getAttendanceResultsByTeacherAndDateRange(...)`
  - 按日期/班级/学生做聚合展示，类似一个“考勤日历 + 汇总”页面。

> 这个 Fragment 更偏统计视角，不是你要的“对话/会话式签到页面”。

---

## 4. 新需求在现有实体上的映射（不改 DB）

> 重点：只改变代码对现有字段的使用方式，不改变表结构。

### 4.1 “签到会话实体”的落地

- 一次老师发起的考勤 = 一条 `AttendanceSession`。
- 对应字段：
  - `id`：唯一标识这次签到；
  - `classId`：班级；
  - `teacherId`：发起者；
  - `attendanceType`：当前有 `FACE / MANUAL / MIXED` 三种合法值；
  - `status`：`ACTIVE / COMPLETED / CANCELLED`，可用来标识签到是否仍在进行中。

> 在本设计中，我们**不改这个表的结构**，只约定对 `attendanceType` 的语义使用方式：

- 建议约定（不需要修改 SQL，只是逻辑约定）：
  - `FACE`：**教师照片考勤模式**（当前模式）；
  - `MANUAL`：**学生自拍签到模式**；
  - `MIXED`：保留为未来扩展（比如教师照片 + 学生补签的混合模式）。

### 4.2 “签到结果实体”的落地

- `AttendanceResult` 继续作为学生在某次 `AttendanceSession` 中的考勤状态记录：
  - `sessionId`：指向这次签到；
  - `studentId`：学生；
  - `status`：`Present/Absent/Late/Leave/Unknown`；
  - `score / confidence`：可以用作识别置信度等；
  - `checkInTime`：学生签到时间（后续在自拍模式中可以填此字段）。

> 学生自拍签到模式下，只是插入/更新这一表中的记录，不需要新表。

---

## 5. 教师端设计：两种签到模式

### 5.1 模式选择（仅逻辑设计）

在教师选择班级后（`ClassroomSelectionActivity.onClassroomSelected`），当前直接跳转：

```java
Intent intent = new Intent(this, AttendanceActivity.class);
intent.putExtra("classroom_id", classroom.getId());
...
startActivity(intent);
```

**新设计（不改 DB，只改启动参数和 UI）：**

1. 教师点击班级进行考勤时，弹出一个简单对话框：

   - 「请选择考勤方式」
     - 选项 A：教师照片考勤（导入合照，自动识别）
     - 选项 B：学生自拍考勤（学生自己打卡）

2. 根据选择，在 `Intent` 中添加额外参数，例如：

   - `intent.putExtra("attendance_mode", "FACE");` 或
   - `intent.putExtra("attendance_mode", "MANUAL");`

3. 在 `AttendanceActivity.createAttendanceSession()` 中：

   - 读取该参数，并调用 `insertAttendanceSession()` 时，通过 **业务逻辑** 决定写入 `attendanceType` 为 `'FACE'` 或 `'MANUAL'`。
   - 这一过程使用现有字段，不修改建表语句。

### 5.2 教师端 UI 行为变化

- 当 `attendanceType = 'FACE'`：
  - 行为与当前版本保持一致：
    - 提示老师拍照/导入图片；
    - 使用 ML Kit 做多人人脸检测与识别；
    - 最终调用 `persistAttendanceResultsForSession` 写入 `Present/Absent` 结果；
    - 跳转 `AttendanceResultActivity` 展示。

- 当 `attendanceType = 'MANUAL'`：
  - `AttendanceActivity` 主要负责：
    - 创建 `AttendanceSession`；
    - 显示类似“已发布签到任务，等待学生客户端自行签到”的界面；
    - 不要求老师必须上传照片，也不执行多人识别；
    - 老师可以在这里看到当前已签到人数（后续可根据 `AttendanceResult` 实时查询，属于进一步优化）。

---

## 6. 学生端设计：班级签到对话页

### 6.1 替换“选课页”的整体思路

**现状：**

- `nav_courses` -> [StudentCoursesFragment.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/fragments/StudentCoursesFragment.java)
- 只是 mock 课程列表，对考勤核心业务没有实际作用。

**目标：**

- 复用底部导航条的位置，不改菜单结构，仅替换 Fragment 内容和标题：
  - 标题从“选课”改为“签到”或“班级签到”；
  - Fragment 改为“班级签到对话页”，显示：
    - 当前学生所属班级列表；
    - 每个班级下的签到会话列表（`AttendanceSession`）；
    - 每个会话项显示：
      - 发起时间（startedAt）；
      - 考勤方式（FACE=教师照片 / MANUAL=学生自拍）；
      - 会话状态（ACTIVE / COMPLETED）；
      - 当前学生是否已签到（在此 `sessionId` 下是否存在该 `studentId` 的 `AttendanceResult` 且状态=Present）。

### 6.2 班级与学生的关系获取

项目中已有：

- `Student`、`Classroom` 等实体；
- `DatabaseHelper.getClassroomsByTeacher(teacherId)`（教师视角）
- `getAttendanceResultsByStudentAndDateRange(studentId, ...)`（学生视角）

学生所属班级可以通过以下方式之一获取（具体以现有字段为准）：

- 在 `Student` 表中存在 `classId` 字段（常见设计）；
- 或通过中间表（若有）关联。  
（这里文档不修改结构，只说明“需要根据当前登录学生找到其班级列表”。）

### 6.3 “类似聊天室”的列表结构

在新的学生端签到 Fragment 中，可以按如下逻辑：

1. 通过当前登录学生 id（从 `user_prefs` 或 `student_prefs` 中读取）。
2. 查出该学生所属的一个或多个班级（classId 列表）。
3. 针对这些 classId，从 `AttendanceSession` 表中读取相关会话：
   ```sql
   SELECT * FROM AttendanceSession
   WHERE classId IN (...)
   ORDER BY startedAt DESC;
   ```
4. 对每个会话项，附加当前学生在其中的签到状态：
   - 查询 `AttendanceResult`：
     ```sql
     SELECT status FROM AttendanceResult
     WHERE sessionId = ? AND studentId = ?
     LIMIT 1;
     ```
   - 若存在且 status=Present，则在 UI 上标记为“已签到”；否则标记为“未签到”。

列表 UI 表现类似：

- **教师照片模式会话**（attendanceType = FACE）：
  - 图标或小字标注：「教师照片考勤」
  - 一般情况下学生不单独签到（除非未来你想开放学生补签）。
- **学生自拍模式会话**（attendanceType = MANUAL）：
  - 图标或小字标注：「学生自拍考勤」
  - 若当前学生未签到，显眼提示“待签到”；已签到则显示“已签到”。

---

## 7. 学生自拍签到流程设计（单人识别）

### 7.1 识别能力复用

现有的人脸识别能力集中在：

**文件：**  
[FaceRecognitionManager.java](file:///d:/typer/android_demo/FaceCheck/app/src/main/java/com/example/facecheck/utils/FaceRecognitionManager.java)

关键方法示例：

- 单人识别（ML Kit 检测 + 特征提取）：
  ```java
  public RecognitionResult recognizeFace(Bitmap faceBitmap, Face face)
  public RecognitionResult recognizeFace(Bitmap sourceBitmap, Rect bbox)
  ```

- 班级范围内批量比对（多人人脸）：
  ```java
  public List<RecognitionResult> recognizeMultipleFacesWithinClass(List<Bitmap> faceBitmaps,
          List<com.google.mlkit.vision.face.Face> faces, long classroomId)
  public List<RecognitionResult> recognizeImportedVectorsWithinClass(List<float[]> importedVectors,
          long classroomId)
  ```

> 学生自拍模式只需要“识别一张脸 + 限定在本班级”，可以在不改 DB 的前提下复用以上逻辑（调用时传当前班级 id）。

### 7.2 学生自拍签到 Activity 的业务流程

设计一个“学生签到页面”（后续可以命名为 `StudentSignInActivity`，此处只做设计）：

1. **页面入口**
   - 从“班级签到对话页”点击某个 `AttendanceSession`（且 `attendanceType = MANUAL`）进入；
   - 通过 Intent 传入：
     - `sessionId`
     - `classId`
     - 当前学生 `studentId`

2. **拍照/导入图片**
   - 页面提供“拍照/从相册选取”按钮；
   - 拿到单张 Bitmap 后，使用 ML Kit 进行人脸检测：
     - 若检测到 0 张脸：提示“未检测到人脸，请重新拍照”；
     - 若检测到多张脸：提示“请使用单人照片”。

3. **特征提取 + 识别**
   - 对检测到的那一张人脸：
     - 用 `FaceRecognitionManager` 提取特征向量；
     - 在当前班级范围内进行识别：
       - 可以调用类似 `recognizeImportedVectorsWithinClass` 的逻辑，但只处理一个向量；
       - 或增加一个专门的 `recognizeSingleFaceWithinClass` 方法（仍然只使用现有表数据）。

4. **结果判定 & 防止冒名**
   - 若识别结果 `studentId` 与当前登录学生的 `studentId` 不一致：
     - 提示“识别结果与当前账号不匹配，请使用本人的照片”，不写入结果；
   - 若一致且相似度达到阈值：
     - 进入下一步写入/更新 `AttendanceResult`。

5. **写入/更新 AttendanceResult（不改 DB 结构）**
   - 以 `(sessionId, studentId)` 为逻辑唯一键：
     - 若尚无记录：
       - 插入一条 `status='Present'`、`decidedBy='AUTO'` 或 `'SYSTEM'`；
       - 可以填 `checkInTime = 当前时间`。
     - 若已有记录（例如老师端已标记 Absent）：
       - 更新为 `status='Present'`（视业务规则而定）；
       - 或禁止重复签到，视你想要的规则而定。
   - 以上操作只使用现有的 `insertAttendanceResult` / `update` 方法实现，不涉及表结构变化。

6. **前端反馈**
   - 签到成功后：
     - 页面提示“签到成功”；
     - 返回到“班级签到对话页”，刷新当前会话状态为“已签到”。

---

## 8. 统一规则：一人一次会话一条记录

无论是教师照片模式还是学生自拍模式，都应遵循业务规则：

> 对于同一个 `(sessionId, studentId)`，在 `AttendanceResult` 中逻辑上只保留一条状态记录。

现有老师端自动识别中，我们已经做过一部分处理（去重）。后续在学生自拍模式实现时，应该遵循同样原则：

- 写入前先查询是否已有该 `(sessionId, studentId)` 的记录；
- 按业务规则决定是：
  - 更新状态（例如从 Absent 改为 Present）；或
  - 阻止重复签到并提示用户。

这一规则完全可以在业务层（Java 代码）实现，不依赖数据库层的唯一约束。

---

## 9. 实施顺序建议（仅设计，未实际修改）

在不改数据库结构的前提下，建议按以下顺序逐步实现，避免大范围一次性改动：

1. **教师端模式选择**
   - 在 `ClassroomSelectionActivity` 中为“开始考勤”增加对话框，选择：
     - “教师照片考勤（FACE）”
     - “学生自拍考勤（MANUAL）”
   - 将选择结果通过 Intent 传给 `AttendanceActivity`，并在创建 `AttendanceSession` 时写入到现有 `attendanceType` 字段（仅通过业务逻辑写值，不改建表）。

2. **教师端对 MANUAL 模式的展示**
   - 当 `AttendanceActivity` 发现 `attendanceType = MANUAL` 时：
     - 不强制老师上传照片；
     - 显示“已发布签到任务，学生可通过客户端自拍签到”的提示。

3. **学生端：替换选课页**
   - 将 `StudentCoursesFragment` 改造成“班级签到对话页”：
     - 列出当前学生的班级和对应的 `AttendanceSession` 列表；
     - 标记哪些会话已经签到、哪些未签到；
     - 点击 MANUAL 类型的会话，进入学生自拍签到页。

4. **学生自拍签到页**
   - 新建一个简单 Activity，完成：
     - 拍照/选图；
     - 单人脸检测；
     - 班级内识别；
     - 写入/更新 `AttendanceResult`。

5. **统一 `(sessionId, studentId)` 的写入逻辑**
   - 抽象出一段公共逻辑，保证对同一会话同一学生只出现一条记录，或通过更新方式保持一致。

---

## 10. 总结

- 当前项目中，**“签到实体”已经明确存在**：
  - `AttendanceSession` = 一次老师发起的考勤/签到；
  - `AttendanceResult`  = 某个学生在这次签到中的结果。
- 本设计在**完全不修改数据库结构**的前提下：
  - 利用现有 `attendanceType` 字段区分“教师照片考勤”和“学生自拍考勤”；
  - 替换学生端的 mock 选课页为“班级签到对话页”；
  - 使用现有的人脸识别能力为学生提供“单人自拍签到”功能；
  - 通过业务逻辑控制 `(sessionId, studentId)` 的唯一性，避免重复、多条记录的问题。

后续如果你需要，我可以按你指定的顺序，从**教师模式选择**开始，一步步把上面的设计落到具体代码里，保证每一步改动都小且可编译通过。  
目前这份文档已经可以直接保存为一个 `.md` 文件作为项目的设计说明。  

---

## 11. 实现状态记录

> 更新时间：2026-01-08

### 11.1 已完成实现

以下功能已按照上述设计完成实现并通过编译：

#### ✅ 1. 演示模式（Demo Mode）

- **文件**: `SettingsActivity.java`
- **功能**: 在"关于 FaceCheck"项上三击（500ms 内）可切换演示模式
- **状态**: 演示模式状态保存在 `SharedPreferences("demo_mode_prefs")`

#### ✅ 2. 教师端模式选择

- **文件**: `ClassroomSelectionActivity.java`
- **功能**: 在 `mode = "attendance"` 时弹出对话框，提供两个选项：
  - "教师照片考勤（默认）" → `attendance_type = "FACE"`
  - "学生自拍考勤" → `attendance_type = "MANUAL"`
- **实现**: 选择结果通过 Intent extra 传递给 `AttendanceActivity`

#### ✅ 3. 数据库方法扩展

- **文件**: `DatabaseHelper.java`
- **新增方法**:
  - `insertAttendanceSession(..., String attendanceType)` - 支持传入考勤类型
  - `getActiveManualAttendanceSessionsByClass(long classId)` - 获取班级的活跃 MANUAL 会话
  - `getActiveAttendanceSessionsByClass(long classId)` - 获取班级所有活跃会话
  - `isStudentSignedIn(long sessionId, long studentId)` - 检查学生是否已签到

#### ✅ 4. AttendanceSession 模型扩展

- **文件**: `AttendanceSession.java`
- **新增字段**: `teacherId`, `status`, `attendanceType`, `endedAt`
- **新增构造函数和 getter/setter 方法**

#### ✅ 5. AttendanceActivity MANUAL 模式支持

- **文件**: `AttendanceActivity.java`
- **功能**:
  - 读取 `attendance_type` Intent 参数
  - 创建会话时传入 `attendanceType`
  - 当模式为 `MANUAL` 时，调用 `setupManualModeUI()` 隐藏照片相关控件，显示提示信息

#### ✅ 6. 学生自拍签到 Activity

- **新建文件**: `StudentSignInActivity.java`
- **布局文件**: `activity_student_sign_in.xml`
- **功能**:
  - 接收 `session_id`, `class_id`, `student_id` 参数
  - 支持拍照或从相册选择照片
  - 使用 `detectFacesSync()` 进行同步人脸检测
  - 使用 `verifyStudentIdentity()` 进行 1:1 身份验证
  - 验证成功后写入/更新 `AttendanceResult`
  - 防止多人脸照片和非本人照片

#### ✅ 7. 学生端签到页面

- **文件**: `StudentCoursesFragment.java`（重写）
- **布局文件**: `fragment_student_sign_in.xml`, `item_sign_in_session.xml`
- **功能**:
  - 显示当前学生班级的所有活跃 MANUAL 考勤会话
  - 每个会话显示：时间、类型、备注、签到状态
  - 已签到显示 "✓ 已签到"（绿色）
  - 未签到显示 "待签到"（橙色）+ "去签到" 按钮
  - 支持手动刷新（FAB 按钮）

#### ✅ 8. FaceRecognitionManager 扩展

- **文件**: `FaceRecognitionManager.java`
- **新增方法**: `verifyStudentIdentity(Bitmap faceBitmap, Face face, long studentId)`
- **功能**: 1:1 人脸验证，仅与指定学生的特征向量比对

#### ✅ 9. FaceDetectionManager 扩展

- **文件**: `FaceDetectionManager.java`
- **新增方法**: `detectFacesSync(Bitmap bitmap)`
- **功能**: 同步版人脸检测，使用 CountDownLatch 阻塞等待结果

#### ✅ 10. AndroidManifest 更新

- **新增声明**: `StudentSignInActivity`

#### ✅ 11. 资源文件

- **新增 Drawable**:
  - `bg_preview_frame.xml` - 预览框背景
  - `bg_tag_primary.xml` - 类型标签背景
  - `ic_arrow_back.xml` - 返回箭头图标
  - `ic_camera_placeholder.xml` - 相机占位图标
  - `ic_refresh.xml` - 刷新图标
- **新增颜色**: `surface` 颜色
- **新增字符串**: `preview_image`

---

### 11.2 待完善/后续优化

1. **演示模式实际效果**: 演示模式开关已实现，但在识别逻辑中的模拟结果功能需进一步集成
2. **教师端 MANUAL 模式实时状态**: 可添加实时显示已签到人数的功能
3. **学生班级信息获取**: 当前从 `SharedPreferences` 读取 `class_id`，需确保登录时正确写入
4. **会话状态管理**: 可添加教师手动结束签到会话的功能
5. **签到时间窗口**: 可添加签到有效期限制

---

### 11.3 编译状态

```
BUILD SUCCESSFUL
17 actionable tasks: 17 up-to-date
```

所有代码已通过 `./gradlew :app:compileDebugJavaWithJavac` 编译验证。